#!/usr/bin/env bash

# This script annoys the user until they respond, usually for a stated purpose

. $SKIGGETY_UTILS_DIR/lib/skiggety-utils.bash || exit 1
. $SKIGGETY_UTILS_DIR/lib/firstlife.bash || exit_with_error 'could not use common firstlife code'

# TODO^5: this script,and those that call it, will probably need an '--ignore-mute' option at some point

# TODO^4: make sure volume is up

SNOOZE_SECONDS=60 # TODO^2: make configurable
export SNOOZE_SECONDS

SNOOZE_BACKOFF_SECONDS=30 # TODO^3: make configurable

while firstlife-single-alarm "$*";do
    tput bel # a.k.a. ding, bell (for searchability) # TODO?: DELETE now that we have another sound

    SNOOZE_SECONDS="$(( $SNOOZE_SECONDS + $SNOOZE_BACKOFF_SECONDS ))"
    export SNOOZE_SECONDS
    echo
done
echo
echo 'Alarm stopped'

exit 0
