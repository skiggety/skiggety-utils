#!/usr/bin/env bash

# This script prompts you to do something from your 'vital' todo list, based on a tag

. $SKIGGETY_UTILS_DIR/lib/skiggety-utils.bash || exit 1

# TODO^2: use this script more widely
# TODO: DRY with zl-iterate

# TODO: accept some sort of option for a duration, so we can set a timer and mute
TAG="IN_PROGRESS"
if ! [[ -z "$1" ]]; then
    TAG="$1"
    shift
fi

# TODO^7: accept an optianal tag for vital, like (on a separate line----------------------------------------------)
# "URGENT", "NOW", or "FUN".  Pick randomly from vital tasks with the tag, weighted towards the ones with the most
# votes, and ask the user to get it done or at least put in a pomodoro's worth of time.  Maybe pass a '--random' option
# to 'zl-iterate-on-vital' or 'zl-iterate-on-vital-tag'

vital-list-by-tag $TAG
zl-delegate "Edit your 'vital' todo list with attention to the tag '$TAG' (use 'vital-list-by-tag $TAG' command to see summary)" || exit_with_error "Not grooming $TAG tasks"
zl-iterate-on-vital-tag -n 1 $TAG || \
    zl-delegate "Work on something from your 'vital' todo list tagged '$TAG'" || \
    exit_with_error "skipped doing something tagged '$TAG' from your 'vital' todo list."
