#!/usr/bin/env bash

# This script waits for a routine to finish, like your morning routine, so other routines and such can back off until
# the right time.

. $SKIGGETY_UTILS_DIR/lib/skiggety-utils.bash || exit 1
. $SKIGGETY_UTILS_DIR/lib/firstlife.bash || exit_with_error 'could not use common firstlife code'

WHICH_ROUTINE="$1"
shift

# TODO^19: this should should display what's waiting and since when

if [ -z "$WHICH_ROUTINE" ]; then
    exit_with_error "you must specify which routine you are waiting for:"
fi

i=1
while ! has_routine_succeeded_today $WHICH_ROUTINE;do
    exit_if_day_is_over # NOT 'firstlife_exit_if_needed'!

    # TODO^49: function extract to firstlife.bash:
    for blank_line_i in $(seq $(tput lines));do echo; done # push everything to the bottom of the terminal

    # TODO: do something similar in firstlife-wait-for-user:
    banner -w 40 "Waiting for $WHICH_ROUTINE" | slow-cat # TODO: script extract: "slow-banner"

    echo "Waiting another $i seconds for you to finish '$WHICH_ROUTINE' (successfully for $FIRSTLIFE_ISOTODAY)."
    sleep-verbose $i
    i=$(( $i + 1))
done
oop
