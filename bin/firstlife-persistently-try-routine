#!/usr/bin/env bash

# This script helps you retry and debug a routine to make sure you get through it.

. $SKIGGETY_UTILS_DIR/lib/skiggety-utils.bash || exit 1
. $SKIGGETY_UTILS_DIR/lib/firstlife.bash || exit_with_error 'could not use common firstlife code'

# TODO^51: firstlife-preempt-same-command

WHICH_ROUTINE="$1"
tries=0
while ! $WHICH_ROUTINE;do
    tries=$(( $tries + 1 ))
    exit_if_day_is_over
    shellask "Now that $WHICH_ROUTINE has failed, do you want to edit it for next time?" && \
        vim -o $FIRSTLIFE_DIR/bin/*${WHICH_ROUTINE}* $SKIGGETY_UTILS_DIR/bin/templates/*${WHICH_ROUTINE}* $FIRSTLIFE_CODE_DIR/bin/${WHICH_ROUTINE}
    exit_if_day_is_over
    firstlife-break -t $((tries * 60))
    exit_if_day_is_over
done
