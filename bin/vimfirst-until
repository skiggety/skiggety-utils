#!/usr/bin/env bash

# TODO^200: this should be a special mode of vimfirst, so it shares code, just another way of using a --while flag

RUN_NEWBIN='false'
while [[ "$1" == -* ]]; do
    if [ "$1" == "--debug" ]; then # TODO^30 # : This seems like a good pattern to repeat.
        SKIGGETY_DEBUG='true'
        shift
    elif [ "$1" == "--newbin" ]; then # TODO^30 # : This seems like a good pattern to repeat.
        RUN_NEWBIN='true'
        shift
    fi
done

if $RUN_NEWBIN; then
    newbin "$1"
fi

vimwhich "$1"

until "$@"
do
    echo "Command '$@' FAILED, take a look'" && sleep-verbose 10
    vimwhich "$1"
    echo "Sleeping for 5 seconds, CTRL+C to quit..." # TODO^19: TEST does CTRL+C actually work?
    sleep-verbose 5 || exit_with_error "User quit..."
done
