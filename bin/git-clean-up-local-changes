#!/usr/bin/env bash

# This script helps the user to make sure local changes get committed and pushed

. $SKIGGETY_UTILS_DIR/lib/skiggety-utils.bash || exit 1

function celebrate {
    {
        echo_divider ".  "
        echo_divider ".   "
        echo_divider ".    "
        echo_divider ".     "
        echo_divider ".      "
        echo_divider ".       "
        echo_divider ".        "
        echo_divider ".         "
        echo_divider_with_text ".          " "$(basename $(pwd)) has no changes or commits outstanding!"
        echo_divider ".         "
        echo_divider ".        "
        echo_divider ".       "
        echo_divider ".      "
        echo_divider ".     "
        echo_divider ".    "
        echo_divider ".   "
        echo_divider ".  "
    } | slow-cat
}

if ! git rev-parse; then
    exit_with_error "$(pwd) is not a git repository"
fi

if git-no-unpushed-changes && git-no-uncommitted-changes; then
    celebrate
    exit 0
else
    dashboard
    git safe-pull
    shellask "Commit something, probably using 'cgry' or 'ci && git ready && yup'. (in $(pwd))" || exit_with_error "did not commit"
fi

if git-no-unpushed-changes && git-no-uncommitted-changes; then
    celebrate
    exit 0
fi
