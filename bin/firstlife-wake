#!/usr/bin/env bash

# This script makes sure you are awake when firstlife starts

. $SKIGGETY_UTILS_DIR/lib/skiggety-utils.bash || exit 1
. $SKIGGETY_UTILS_DIR/lib/firstlife.bash || exit_with_error 'could not use common firstlife code'

# make sure this script only runs once a day:
# EASY TODO^86: method extract firstlife-exit-if-this-ran-today <task_name> so we can mark other things
THIS_SCRIPT_RAN_MARKER_FILE="$FIRSTLIFE_DIR/markers/$(basename $0).ran_on_${FIRSTLIFE_ISOTODAY}"
if [ -f $THIS_SCRIPT_RAN_MARKER_FILE ]; then
    echo "'$(basename $0)' already ran today ($FIRSTLIFE_ISOTODAY), exiting without error..."
    exit 0
fi

# TODO^36: alert user with sound, queue videos? mplayer? toaster-ding?
# - TODO^36: but first, bring terminal to the front, maybe just as part of firstlife-delegate, too
# - EASY TODO^58: I think i should play (with mplayer) an annoying sound for a minute, in a 3 minute loop, until I shut it up, called firstlife-alarm
#   - TODO: make sure volume is up

exit_if_day_is_over

use_and_maintain_inner_routine_based_on_template 'wake' "$0"

exit_with_any_accumulated_errors

# EASY FUN TODO^86: method extract firstlife-mark-done <task_name> so we can mark other things: 'firstlife-mark-done-today $0'
mkdir -p "$(dirname $THIS_SCRIPT_RAN_MARKER_FILE)"
debug_here "marking wake routine done with command: touch $THIS_SCRIPT_RAN_MARKER_FILE"
touch $THIS_SCRIPT_RAN_MARKER_FILE

exit
