#!/usr/bin/env bash

# This script reminds you of something after a certain number of minutes.

. $SKIGGETY_UTILS_DIR/lib/skiggety-utils.bash || exit 1

MINUTES_LEFT="15"
TITLE="Do what's on your calendar"

while [[ "$1" == -* ]]; do
    if [ "$1" == "-m" -o "$1" == "-t" -o "$1" == "--time-in-minutes" ]; then # TODO^14: Don't use -m for this...
        shift
        MINUTES_LEFT="$1"
        debug_eval_here MINUTES_LEFT
        shift
    elif [ "$1" == "--respect-mute" ]; then
        shellask "TODO^33: IMPLEMENT --respect-mute for $(basename $0), or at least vote $(echo_here)"
        shift
    elif [ "$1" == "--ignore-mute" ]; then
        shellask "TODO^42: IMPLEMENT --ignore-mute for $(basename $0), or at least vote $(echo_here) (should this be the default behavior?)"
        shellask "- TODO^51: should --ignore-mute be the default behavior?"
        shift
    elif [ "$1" == "-h" -o "$1" == "--help" ]; then
        exit_with_error "TODO: implement help"
    fi
done
TITLE="$*"

echo "Sleeping for $MINUTES_LEFT minutes at $(date) ..."
debug_here sleep-verbose --with-countdown "$(( $MINUTES_LEFT * 60 ))"
sleep-verbose --with-countdown "$(( $MINUTES_LEFT * 60 ))"

zl-alarm "Time for '$TITLE' NOW!"
echo_divider_with_text "=" "Time for '$TITLE' NOW!"
