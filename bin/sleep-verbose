#!/usr/bin/env bash

# This script sleeps for a specified number of seconds, displaying progress as
# it goes.

. $SKIGGETY_UTILS_DIR/lib/skiggety-utils.bash || exit 1

# TODO^2?: show a clock, optionally
# TODO^2?: integrate into a banner

# TODO^2?: take a '-m <message>' option to display a custom message

PRINT_NEWLINE=true
SHOW_COUNTDOWN=false
while [[ "$1" == -* ]]; do
    if [ "$1" == "-n" ];then
        PRINT_NEWLINE=false
        shift
    elif [ "$1" == "--with-countdown" ]; then
        SHOW_COUNTDOWN=true
        shift
    fi
done

function main {
    delay="$1"

    delay_remaining="$delay"

    while [ "$delay_remaining" -gt 0 ]; do
        if $SHOW_COUNTDOWN && [ $delay_remaining -lt 10 ]; then
            clear
            banner $delay_remaining
        fi
        echo -ne "  sleeping for $delay_remaining/$delay seconds\033[0K\r"
        sleep 1
        : $((delay_remaining--))
    done
    echo -ne "  DONE! ($(basename $0) slept for $delay seconds)\033[0K\r"

    if $PRINT_NEWLINE; then
        echo
    fi
}
main "$@"
