#!/usr/bin/env bash

# This script runs in the evening to help you wrap up your day.

. $SKIGGETY_UTILS_DIR/lib/skiggety-utils.bash || exit 1
. $SKIGGETY_UTILS_DIR/lib/firstlife.bash || exit_with_error 'could not use common firstlife code'

# TODO^2?: exit if a script with identical name and path is in parent tree

exit_if_day_is_over # EASY to chip away at TODO^84: infect this and called scripts with this line all over the place to clean up windows (for ORGANIZATION)

################################################################################
# EASY TODO^87: normalize scripts with names like:
# - firstlife-evening
#   - firstlife-evening.routine.<username>
#   - firstlife-evening.routine.TEMPLATE

# make sure this script only runs once a day:
# EASY FUN TODO^89: method extract firstlife-exit-if-this-ran-today <task_name> so we can mark other things
THIS_SCRIPT_RAN_MARKER_FILE="$FIRSTLIFE_DIR/markers/$(basename $0).ran_on_${FIRSTLIFE_ISOTODAY}"
if [ -f $THIS_SCRIPT_RAN_MARKER_FILE ]; then
    echo "'$(basename $0)' already ran today ($FIRSTLIFE_ISOTODAY), exiting without error..."
    exit 0
fi

exit_if_day_is_over # EASY to chip away at TODO^86: infect this and called scripts with this line all over the place to clean up windows (for ORGANIZATION)

use_and_maintain_inner_routine_based_on_template 'evening' "$0"

exit_if_day_is_over

# EASY FUN TODO^89: method extract firstlife-mark-done <task_name> so we can mark other things:
mkdir -p "$(dirname $THIS_SCRIPT_RAN_MARKER_FILE)"
debug_here "marking evening routine done with command: touch $THIS_SCRIPT_RAN_MARKER_FILE"
touch $THIS_SCRIPT_RAN_MARKER_FILE

exit
