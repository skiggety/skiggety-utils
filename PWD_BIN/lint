#!/usr/bin/env bash

THIS_DIR="$(cd "$(dirname $BASH_SOURCE)";pwd)"
. $THIS_DIR/../lib/skiggety-utils.bash || exit 1

echo_divider_with_text "O-=======-" "lint:"

# echo_divider_with_text "+-=======-" "generate ./todo_report.gen.txt:"
TODO_REPORT_LINES=5
# TODO: in the future, use 'todo --exclude <FILE>' (when it's supported) instead of relying on 'grep -v'
todo_report="$(todo --exclude-dir coverage_links --exclude-dir coverage | grep -v "^./todo_report.gen.txt:" | grep -v ".gitignored." | tail -n $TODO_REPORT_LINES )"
echo "$todo_report" > todo_report.gen.txt
# echo "$todo_report"

echo_divider_with_text "+-=======-" "rubocop:"
bundle exec rubocop -P --color || accumulate_error 'rubocop reported errors'

echo_divider_with_text "+-=======-" "pylint:"
# TODO: abbreviate output?:
pylint --rcfile .pylintrc bin/todo lib/todo_line.py || accumulate_error 'pylint reported errors' # TODO automatically scan all python files

exit_if_any_accumulated_errors
